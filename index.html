<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <title>QA Automation Kanban Tracker</title>
  <style>
    body {
      font-family: 'Nunito', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #fce4ec, #e1bee7, #b2ebf2);
      margin: 0;
      padding: 20px;
      color: #2c2c2c;
      background-size: cover;
      background-attachment: fixed;
    }
    h1 {
      text-align: center;
      color: #ffb6c1;
      font-size: 2.2em;
      margin-bottom: 30px;
      animation: fadeIn 1s ease-in-out;
    }
    .header-img {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .header-img img {
      max-width: 200px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      animation: fadeIn 2s ease-in-out;
    }
    .kanban {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .add-column {
      margin-top: 20px;
    }
    .add-column button {
      padding: 8px 12px;
      margin-right: 5px;
      background-color: #2196f3;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .add-column input {
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .column {
      background: #fff0f5;
      border-radius: 12px;
      padding: 15px;
      width: 30%;
      min-width: 280px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.2s ease-in-out;
    }
    .column:hover {
      transform: scale(1.01);
    }
    .column h2 {
      text-align: center;
      color: #4a4a4a;
    }
    .task {
      background: #fff;
      border-left: 5px solid #f06292;
      margin: 10px 0;
      padding: 12px;
      border-radius: 6px;
      cursor: grab;
      position: relative;
      transition: background 0.3s ease;
    }
    .task:hover {
      background: #ffe4ec;
    }
    .task .actions {
      position: absolute;
      top: 5px;
      right: 5px;
      display: flex;
      gap: 5px;
    }
    .task button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 16px;
    }
    .task input, .task textarea {
      width: 100%;
      border: none;
      background: transparent;
      resize: none;
      font-size: 0.95em;
    }
  </style>
  <audio id="dragSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_58d20b4be5.mp3"></audio>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="header-img">
    <img src="https://i.gifer.com/9P3h.gif" alt="Chi Anime" style="border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2); max-height:200px;">
  </div>

  <div class="kanban">
    <div class="column" id="todo">
      <h2>üì• Backlog</h2>
    </div>
    <div class="column" id="inProgress">
      <h2>‚öôÔ∏è In Progress</h2>
    </div>
    <div class="column" id="done">
      <h2>‚úÖ Done</h2>
    </div>
  </div>

  <div class="add-column">
    <button onclick="showAddColumnInput()">+ –î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    <div id="add-column-form" style="display:none;">
      <input type="text" id="new-column-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞" />
      <button onclick="addColumn()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button onclick="hideAddColumnInput()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

 <script>
  const saveBtn = document.getElementById('saveBtn');
  let columns = {};
  let tasks = JSON.parse(localStorage.getItem('qaKanbanTasks')) || [];
  let idCounter = tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1;

  function initColumns() {
    columns = {};
    document.querySelectorAll('.column').forEach(col => {
      columns[col.id] = col;
    });
  }

  function saveToStorage() {
    localStorage.setItem('qaKanbanTasks', JSON.stringify(tasks));
  }

  function renderTasks() {
    initColumns();
    Object.values(columns).forEach(col => col.querySelectorAll('.task').forEach(el => el.remove()));

    tasks.forEach(task => {
      const el = document.createElement('div');
      el.className = 'task';

      const deadlineDate = task.deadline ? new Date(task.deadline) : null;
      const now = new Date();
      if (deadlineDate && deadlineDate < now) {
        el.style.borderLeft = '5px solid #ff1744';
      } else if (deadlineDate && (deadlineDate - now) / (1000 * 60 * 60 * 24) < 2) {
        el.style.borderLeft = '5px solid #ff9800';
      } else {
        el.style.borderLeft = '5px solid #f06292';
      }

      el.draggable = true;
      el.dataset.id = task.id;

      let animeIcon = '';
      if (task.status === 'todo') animeIcon = 'https://i.gifer.com/Pvxu.gif';
      else if (task.status === 'inProgress') animeIcon = 'https://i.gifer.com/9P3h.gif';
      else if (task.status === 'done') animeIcon = 'https://i.gifer.com/OiwA.gif';
      else animeIcon = 'https://i.gifer.com/1zVu.gif';

      el.innerHTML = `
        <img src="${animeIcon}" alt="anime icon" style="width:32px;height:32px;float:left;margin-right:8px;border-radius:50%;">
        <div><strong contenteditable="true" onblur="editTitle(${task.id}, this.innerText)">${task.title}</strong></div>
        <div><textarea rows="2" onblur="editDescription(${task.id}, this.value)">${task.description || ''}</textarea></div>
        ${task.link ? `<a href="${task.link}" target="_blank">üîó –°—Å—ã–ª–∫–∞</a>` : ''}
        ${task.deadline ? `<div>üìÖ Deadline: <strong>${task.deadline}</strong></div>` : ''}
        ${task.estimate ? `<div>‚è± ${task.estimate} —á.</div>` : ''}
        <div class="actions">
          <button onclick="deleteTask(${task.id})">üóëÔ∏è</button>
        </div>
      `;

      el.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', e.target.dataset.id);
        const sound = document.getElementById('dragSound');
        if (sound) {
          sound.currentTime = 0;
          sound.play().catch(() => {});
        }
      });

      const targetColumn = document.getElementById(task.status);
      if (targetColumn) {
        targetColumn.appendChild(el);
      }
    });

    saveToStorage();
  }

  function editTitle(id, text) {
    const task = tasks.find(t => t.id === id);
    if (task) task.title = text.trim();
    saveToStorage();
  }

  function editDescription(id, text) {
    const task = tasks.find(t => t.id === id);
    if (task) task.description = text.trim();
    saveToStorage();
  }

  function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    renderTasks();
  }

  function showAddColumnInput() {
    document.getElementById('add-column-form').style.display = 'block';
  }

  function hideAddColumnInput() {
    document.getElementById('add-column-form').style.display = 'none';
    document.getElementById('new-column-title').value = '';
  }

  function addColumn() {
    const title = document.getElementById('new-column-title').value.trim();
    if (!title) return;

    const board = document.querySelector('.kanban');
    const columnId = title.toLowerCase().replace(/\s+/g, '') + Date.now();

    const column = document.createElement('div');
    column.className = 'column';
    column.id = columnId;
    column.innerHTML = `<h2>${title}</h2>`;

    column.addEventListener('dragover', e => e.preventDefault());
    column.addEventListener('drop', e => {
      const id = e.dataTransfer.getData('text/plain');
      const task = tasks.find(t => t.id == id);
      if (task) {
        task.status = columnId;
        renderTasks();
      }
    });

    board.appendChild(column);
    hideAddColumnInput();
    initColumns();
    renderTasks();
  }

  document.addEventListener('DOMContentLoaded', () => {
    initColumns();
    document.getElementById('taskForm').addEventListener('submit', e => {
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const link = document.getElementById('link').value.trim();
      const column = document.getElementById('column').value;
      const deadline = document.getElementById('deadline').value;
      const estimate = document.getElementById('estimate').value;

      if (!title) return;

      tasks.push({ id: idCounter++, title, description, link, deadline, estimate, status: column });
      e.target.reset();
      document.getElementById('modal').style.display = 'none';
      renderTasks();
    });

    saveBtn.addEventListener('click', () => {
      saveToStorage();
      alert('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ!');
    });

    renderTasks();
  });
</script>

</body>
</html>

